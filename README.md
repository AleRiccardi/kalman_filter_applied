# Kalman Filter Applied

The Kalman Filter Applied package allow you to simulate a trajectory and estimate the odometry based on recorded measurements. The estimation is generated by using the EKF algorithm with constant velocity. The measurements that are taken into account are the following:

* GPS
* Radar

The below image shows the result of combining the measurement for the estimation of the odometry.

<img src="data/images/estimate_1611836926.png" alt="Odometry estimation" style="width:100%; max-width:700px"/>

## The Kalman Filter

Kalman filtering is an algorithm that provides estimates of some unknown variables given the measurements observed over time. The unknown variables, in our case, are the 3D coordinates of our object in the simulated environment. The process model defines the evolution of the state from the previous time ($t - 1$) to the current one ($t$):

$$ 
\hat{\mathrm{x}}_t = F\mathrm{x}_{t-1} + B\mathrm{u}_{t-1} + w
$$

### GPS measurement

...

### Radar measurement

$$
{\begin{aligned}
h(\hat{\mathrm{x}}_t) &=
\begin{pmatrix}
\rho\\ \theta\\ \varphi
\end{pmatrix}
&=
\begin{pmatrix}
{\sqrt {x^{2}+y^{2}+z^{2}}}\\
\arccos \left({\frac {z}{\sqrt {x^{2}+y^{2}+z^{2}}}}\right)\\
\arctan \left({\frac {y}{x}}\right)
\end{pmatrix}
\end{aligned}}
$$


$$
\begin{aligned}
H_t&=
{\frac {\partial h(\hat{\mathrm{x}}_t)}{\partial \left(x,y,z\right)}}&=
{\begin{pmatrix}
{\frac {x}{\rho }}&{\frac {y}{\rho }}&{\frac {z}{\rho }}\\
{\frac {xz}{\rho ^{2}{\sqrt {x^{2}+y^{2}}}}}&{\frac {yz}{\rho ^{2}{\sqrt {x^{2}+y^{2}}}}}&-{\frac {\sqrt {x^{2}+y^{2}}}{\rho ^{2}}}\\
{\frac {-y}{x^{2}+y^{2}}}&{\frac {x}{x^{2}+y^{2}}}&0\\
\end{pmatrix}}
\end{aligned}
$$




## Installation

**Prerequisites**: you need to have ROS installed.

```bash
mkdir -p catkin_ws/src && cd catkin_ws/src
git clone https://github.com/AleRiccardi/kalman_filter_applied.git
# git clone git@github.com:AleRiccardi/kalman_filter_applied.git

cd ..
catkin init
catkin build
source devel/setup.bash
# source devel/setup.zsh
```

## Usage

To launch the simulator:
```bash
roslaunch kfa simulator.launch
```

To estimate the odometry:
```bash
roslaunch kfa kfa.launch
```

## Contributing
Pull requests are welcome. For major changes, please open an issue first to discuss what you would like to change.


## Clang


To use **clang format** you only have to run the following command:

```shell script
./scripts/clang_format.sh
```

To use **clang tidy** first you have to generate the `compile_commands.json` file and then run the script:

```bash
catkin config --cmake-args -DCMAKE_EXPORT_COMPILE_COMMANDS=ON 
catkin build

./scripts/clang_tidy.sh $(catkin locate -b -e kfa)
```


## License
The [MIT](https://choosealicense.com/licenses/mit/) is the licence used.
